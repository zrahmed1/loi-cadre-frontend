<form [formGroup]="signatureForm" role="form" aria-label="Signature Form">
  <mat-form-field appearance="fill" *ngIf="mode === 'create'">
    <mat-label>Loi Cadre</mat-label>
    <mat-select formControlName="loiCadreId" aria-label="Select loi cadre">
      <mat-option [value]="null">-- None --</mat-option>
      <mat-option
        *ngFor="let loiCadre of loisCadres$ | async"
        [value]="loiCadre.id"
        >{{ loiCadre.annee }} (v{{ loiCadre.version }})</mat-option
      >
    </mat-select>
    <mat-error
      *ngIf="
        signatureForm.hasError('atLeastOneId') &&
        !signatureForm.get('loiCadreId')?.value
      "
      >Either Loi Cadre or Mouvement is required</mat-error
    >
  </mat-form-field>
  <mat-form-field appearance="fill" *ngIf="mode === 'create'">
    <mat-label>Mouvement</mat-label>
    <mat-select formControlName="mouvementId" aria-label="Select mouvement">
      <mat-option [value]="null">-- None --</mat-option>
      <mat-option
        *ngFor="let mouvement of mouvements$ | async"
        [value]="mouvement.id"
        >{{ mouvement.type }} ({{ mouvement.description || "-" }})</mat-option
      >
    </mat-select>
    <mat-error
      *ngIf="
        signatureForm.hasError('atLeastOneId') &&
        !signatureForm.get('mouvementId')?.value
      "
      >Either Loi Cadre or Mouvement is required</mat-error
    >
  </mat-form-field>
  <mat-form-field appearance="fill">
    <mat-label>Signataire</mat-label>
    <mat-select formControlName="signataireId" aria-label="Select signataire">
      <mat-option
        *ngFor="let utilisateur of utilisateurs$ | async"
        [value]="utilisateur.id"
        >{{ utilisateur.nom }} {{ utilisateur.prenom || "" }}</mat-option
      >
    </mat-select>
    <mat-error *ngIf="signatureForm.get('signataireId')?.hasError('required')"
      >Signataire is required</mat-error
    >
  </mat-form-field>
  <mat-form-field appearance="fill">
    <mat-label>Status</mat-label>
    <mat-select formControlName="status" aria-label="Select signature status">
      <mat-option
        *ngFor="let status of statutSignatureValues"
        [value]="status"
        >{{ status }}</mat-option
      >
    </mat-select>
    <mat-error *ngIf="signatureForm.get('status')?.hasError('required')"
      >Status is required</mat-error
    >
  </mat-form-field>
  <mat-form-field appearance="fill" *ngIf="mode === 'create'">
    <mat-label>Ordre</mat-label>
    <input
      matInput
      type="number"
      formControlName="ordre"
      aria-label="Signature ordre"
    />
    <mat-error *ngIf="signatureForm.get('ordre')?.hasError('required')"
      >Ordre is required</mat-error
    >
    <mat-error *ngIf="signatureForm.get('ordre')?.hasError('min')"
      >Ordre must be at least 1</mat-error
    >
  </mat-form-field>
  <mat-form-field appearance="fill" *ngIf="mode === 'create'">
    <mat-label>Circuit ID</mat-label>
    <input
      matInput
      type="number"
      formControlName="circuitId"
      aria-label="Circuit ID"
    />
    <mat-error *ngIf="signatureForm.get('circuitId')?.hasError('required')"
      >Circuit ID is required</mat-error
    >
    <mat-error *ngIf="signatureForm.get('circuitId')?.hasError('min')"
      >Circuit ID must be at least 1</mat-error
    >
  </mat-form-field>
  <mat-form-field appearance="fill" *ngIf="mode === 'reject'">
    <mat-label>Motif Rejet</mat-label>
    <input
      matInput
      formControlName="motifRejet"
      aria-label="Rejection reason"
    />
    <mat-error *ngIf="signatureForm.get('motifRejet')?.hasError('required')"
      >Motif Rejet is required</mat-error
    >
  </mat-form-field>
</form>
